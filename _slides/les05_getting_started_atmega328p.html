---
title: "Les 5: Getting started with the ATmega328p"
description: "Rechstreeks aanspreken van de microcontroller op de Arduino Nano"
reveal: 
transition: slide
---
<style>
html.cpu-core body {
  background:url("img/avr_cpu_core.png");
  background-position:right center;
  background-repeat: no-repeat; 
  background-size: contain;
  background-color: #ffffff; }
</style>
<section>
  <h1>Getting started with the ATmega328p</h1>
</section>
<section>
  <h2>Wat is Arduino?</h2>
  <ul>
    <li><h6 class="fragment">Hardware Boards</h6></li>
    <li><h6 class="fragment">Embedded Software</h6></li>
    <li><h6 class="fragment">Ontwikkelingsomgeving</h6></li>
    <li><h6 class="fragment">Rapid Prototyping</h6></li>
  </ul>
  <h2 class="fragment">Voor wie is de arduino gemaakt?</h2>
  <h3 class="fragment">Niet voor ons</h3>
</section>
<section>
  <h2>Is het Arduino platform voldoende?</h2>
  <h2 class="fragment">Nee</h2>
</section>
<section>
  <h2>Wat is Arduino niet</h2>
  <ul>
    <h6>
      <li class="fragment">Efficiënt</li>
      <li class="fragment">Licht Gewicht</li>
      <li class="fragment">Onthullend</li>
      <li class="fragment">Performant</li>
      <li class="fragment">Programmeertaal</li>
    </h6>
  </ul>
</section>
<section>
  <h2>Praktisch Voorbeeld: Memory Usage</h2>
  <div style="float: left; width: 50%;">
    <h3>Using the Arduinio libraries</h3>
    <pre><code style="height: 375px;" class="Arduinio">
#include &ltArduino.h&gt

void setup()
{
    pinMode(LED_BUILTIN, OUTPUT);
}

void loop()
{
    digitalWrite(LED_BUILTIN, HIGH);
    delay(1000);
    digitalWrite(LED_BUILTIN, LOW);
    delay(1000);
}
    </code></pre>
    <p class="fragment">Compiled size: 1034 bytes (3.2%)</p>
  </div>
  <div style="float: left; width: 50%;">
    <h3>Without the Arduino library</h3>
    <pre><code style="height: 375px;"class="Arduino">
#include &ltavr/io.&gt
#include &ltutil/delay.h&gt

int main(void)
{
    DDRB = 1 &lt&lt 5;
    while (1)
    {
        _delay_ms(500);
        PORTB ^= 1 &lt&lt 5;
    }
  return 0;
}
    </code></pre>
    <p class="fragment">Compiled size: 158 bytes (0.5%)</p>
  </div>
</section>
<section>
  <h2>Praktisch Voorbeeld: Efficiëntie</h2>
  <img style="height: 500px;" src="img/arduino_not_efficient.png" alt="">
  <p><small>Snelheid digitalWrite vs bitflip</small></p>
</section>
<section>
  <h2>Arduino is geen taal</h2>
  <ul>
    <h5>
      <li>Arduino is C/C++</li>
      <li>Het Arduino software framework is gebaseerd op wiring</li>
      <li>.ino zijn "wannabe" .cpp files</li>
    </h5>
  </ul>
</section>
<section>
  <div style="float: left; width: 50%;">
    <h3>main.cpp</h3>
    <img src="img/maincpp.png" alt="">
  </div>
  <h3>Blink</h3>
  <div style="float: left; width: 50%;">
    <img src="img/blink_loop.gif" alt="">
  </div>
  <p><small>
    Om een programma te generen voor een Arduino board is er nog heel wat
    achterliggend proces nodig. Het framework verstop dit voor ons, zodat we
    moeilijk een beeld kunnen schetsen van de werking.  
  </small></p>
</section>
<section>
  <h2>Is Arduino geschikt voor ons?</h2>
  <h2 class="fragment">Ja</h2>
  <h3 class="fragment">Maar ...</h3>
  <h3 class="fragment">A great engineer will do for a quarter what a mediocre (at best) engineer takes a dollar to do.</h3>
</section>
<section>
  <h2>De kostprijs van hardware</h2>
  <div class="hcontainer">
    <div class="vcontainer">
      <h3>Arduino Uno</h3>
      <img class="plain" style="background: none; width:40%;" src="img/arduino_uno_board.png" alt="">
      <em><b>Kostprijs ≈ 25 euro</b></em>
    </div>
    <div class="vcontainer">
      <h3>Standalone ATmega328p</h3>
      <img src="img/yabbas.jpg" style="float: right; width: 40%;" alt="">
      <em><b>Kostprijs ≈ 2.5 euro</b></em>
    </div>
  </div>
  <b><em>Dit is geen grondige analyse</em></b>
</section>
<section>
  <h2>Wat zijn de voordelen van het Arduino platform</h2>
  <ul>
    <h5>
      <li class="fragment">Out of the box features</li>
      <li class="fragment">Snel werkend prototype</li>
      <li class="fragment">Programmeren via USB</li>
      <li class="fragment">Bootloader</li>
    </h5>
  </ul>
</section>
<section>
  <h2>Afkicken van Arduino</h2>
  <ul>
    <h5>
      <li>Welke microcontroller gaan we kiezen?</li>
      <li>Hoe gaan we dat aanpakken?</li>
      <ul>
        <li>Werking microcontrollers in het algemeen</li>
        <li>Tooling</li>
        <li>Bit Manipulatie</li>
        <li>Datasheet als handboek</li>
      </ul>
    </h5>
  </ul>
</section>
<section>
  <h2>We kiezen voor de microcontroller...</h2>
  <h1 class="fragment">ATmega328p</h1>
</section>
<section>
  <h2>Microcontroller</h2>
    <div class="hcontainer">
      <ul style="width: 35%;">
        <h5>
          <li>"Standalone"</li>
          <ul>
            <li>Heeft nog enkele randcomponenten nodig</li>
            <li><a href="https://www.instructables.com/id/YABBAS-Yet-Another-Bare-Bones-Arduino-on-Stripb/">YABBAS</a></li>
          </ul>
          <li>Meer dan rekenkundige bewerkingen</li>
          <li>Afmetingen 8mm x 35mm</li>
        </h5>
      </ul>
      <div class="vcontainer">
        <img style="height: 350px;"  src="img/atmega328p.jpg" alt="">
        <img style="height: 350px;"  src="img/yabbas.jpg" alt="">
      </div>
  </div>
</section>
<section>
  <h2>Bouwstenen Microcontroller</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <div style="width: 30%; text-align: left;">
      <h5>CPU</h5>
      <ul>
        <h5>
          <li>ALU</li>
          <li>Register File</li>
          <li>Program Counter</li>
          <li>Stack Pointer</li>
          <li>Status & Control</li>
        </h5>
      </ul>
    </div>
    <img style="height: 500px;" src="img/layout_microcontroller.png" alt="">
  </div>
</section>
<section>
  <h2>Bouwstenen Microcontroller</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <div style="width: 30%; text-align: left;">
      <h5>Analoge IO</h5>
      <ul>
        <h5>
          <li>ADC</li>
          <li>Comperator</li>
          <li>Kwantiseren van data</li>
        </h5>
      </ul>
      <h5>Digitale IO</h5>
      <ul>
        <h5>
          <li>HIGH</li>
          <li>LOW</li>
        </h5>
      </ul>
    </div>
    <img style="height: 500px;" src="img/layout_microcontroller.png" alt="">
  </div>
</section>
<section>
  <h2>Bouwstenen Microcontroller</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <div style="width: 30%; text-align: left;">
      <h5>Timer / Counter</h5>
      <ul>
        <h5>
          <li>2 - 3 Counter</li>
          <li>Timestamping</li>
          <li>Event Counters</li>
          <li>Interval Metingen</li>
        </h5>
      </ul>
    </div>
    <img style="height: 500px;" src="img/layout_microcontroller.png" alt="">
  </div>
</section>
<section>
  <h2>Bouwstenen Microcontroller</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <div style="width: 30%; text-align: left;">
      <h5>Interrupt Controller</h5>
      <ul>
        <h5>
          <li>Onderbreken van het programma</li>
          <li>Speciale hardware interrupts</li>
          <li>Intern of Extern</li>
        </h5>
      </ul>
      <h5>Memory</h5>
      <ul>
        <h5>
          <li>Program / Data Memory</li>
          <li>DMA</li>
          <li>Memory Types</li>
        </h5>
      </ul>
    </div>
    <img style="height: 500px;" src="img/layout_microcontroller.png" alt="">
  </div>
</section>
<section>
  <h2>Bouwstenen Microcontroller</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <div style="width: 30%; text-align: left;">
      <h5>Seriële Interfaces</h5>
      <ul>
        <h5>
          <li>UART</li>
          <li>I2C</li>
          <li>SPI</li>
          <li>...</li>
        </h5>
      </ul>
    </div>
    <img style="height: 500px;" src="img/layout_microcontroller.png" alt="">
  </div>
</section>
<section data-background-image="img/avr_block_diagram.png" data-background-size="contain" data-background-color="white"></section>
<section>
  <h2>Hoe gaan we dit juist aanpakken</h2>
  <h1 class="fragment">Een microcontroller is een digitaal systeem</h1>
  <h4 class="fragment">We moeten dus op de juiste plek de eentjes en de nulletjes correct zetten</h4>
  <h2 class="fragment">Eerst kijken naar de geheugenwerking op de ATMega328p</h2>
</section>
<section>
  <h2>Geheugen Types</h2>
  <img src="img/memory_types_avr.png" alt="">
  <p><em>De in het rood omkaderd zitten in de ATMega328p</em></p>
</section>
<section>
  <h2>AVR Geheugen Map</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <ul>
      <h5>
        <li>Sketch - Flash</li>
        <li>Variablen - SRAM</li>
        <li>EEPROM - Alleen maar wanneer aangesproken</li>
      </h5>
    </ul>
    <img src="img/avr_memory_map.jpg" alt="">
  </div>
</section>
</section>
<section>
  <h2>General / Special Function Register</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <ul style="width: 900px";>
      <h5>
        <li>GPR</li>
        <ul>
          <li>General Purpose Register</li>
          <li>Opslagen van willekeurige data</li>
          <li>Meer info hoofdstuk 11 datasheet</li>
        </ul>
        <li>SFR</li>
        <ul>
          <li>Special Function Register</li>
          <li>Vaste Locatie in het geheugen voor een specifieke functie</li>
          <li>In dit geheugen zit de data/configuratie voor onze bouwstenen</li>
        </ul>
      </h5>
    </ul>
    <img src="img/sfr_mem.png" alt="">
  </div>
</section>
<section>
  <h2> General Register File</h2>
  <div class="hcontainer">
    <ul>
      <h5> 
        <li>Werkgeheugen processor</li>
        <li>Snelste memory</li>
        <li>Index register</li>
        <li>CPU Instructies worden op data vanuit de register file toegepast</li>
      </h5>
    </ul>
    <img src="img/reg_file.png" alt="">
  </div>
</section>
<section>
  <h2>Intermezzo</h2>
  <h1>Instructieset wat is dat?</h1>
</section>
<section data-state="cpu-core" style="text-align: left;">
  <h2 style="color: #000000">Central Processing Unit</h2>
  <ul>
    <h5 style="color: #000000">
      <li>ALU</li>
      <li>Register File</li>
      <li>Program Counter</li>
      <li>Stack Pointer</li>
      <li>Status & Control</li>
    </h5>
  </ul>
  <h3 style="color: #000000;"> Wordt aangestuurd mbv een instructieset</h3>
</section>
<section>
  <h2>Instruction Set</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <img style="height: 500px"; src="img/avr_instructions.png" alt="">
  </div>
</section>
<section>
  <h2>Mnemonics & Opcodes</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <div style="display: flex; justify-content: center; align-items: flex-start; flex-direction: column;">
      <h5>Opcodes</h5>
      <ul>
        <h5>
          <li>Operation Code</li>
          <li>Bytecode dat de CPU kan interpreteren</li>
        </h5>
      </ul>
      <h5>Mnemonics</h5>
      <ul>
        <h5>
          <li>Ezelsbruggetje voor de opcode</li>
          <li>Human Readable</li>
        </h5>
      </ul>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
      <img src="img/opcode.png" alt="">
      <p>
      <h5>ADD | ADC | ADIW | SUB | SUBI | JMP | AND | OR</h5>
      </p>
    </div>
  </div>
</section>
<section>
  <h2>Wat voor taal hebben we nu beschreven?</h2>
  <h1 class="fragment">Assembly</h1>
</section>
<section>
  <h2>Instructie Voorbeeld</h2>
  <img src="img/instruction_example.png" alt="">
</section>
<section>
  <h2>Instruction Types</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <ul>
      <h5>
        <li>Arithmetic</li>
        <li>Branch</li>
        <li>Data</li>
      </h5>
    </ul>
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
      <img src="img/arithmetic_instructions.png" alt="">
      <img src="img/branch_instructions.png" alt="">
      <img src="img/data_instructions.png" alt="">
    </div>
  </div>
</section>
<section>
  <h2>Instruction Types</h2>
  <div style="display: flex; justify-content: center; align-items: center;">
    <ul>
      <h5>
        <li>Bit</li>
        <li>Controle</li>
      </h5>
    </ul>
    <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
      <img src="img/bit_instructions.png" alt="">
      <img src="img/control_instructions.png" alt="">
    </div>
  </div>
</section>
<section>
  <h2>High Level To Machine Code</h2>
  <img style="height: 500px;" src="img/high_to_machine.jpg" alt="">
</section>
<section>
  <h1>Terug naar</h1>
  <h1>GENERAL / SPECIAL FUNCTION REGISTER</h1>
</section>
<section>
  <h2>Special Function Register</h2>
  <img src="img/sfr_example.png" style="height: 500px;"alt="">
  <p><em>Zie Register Summary in datasheet</em></p>
</section>
<section>
  <h2>Tooling</h2>
  <div style="display: flex; justify-content: center; align-items: flex-start;">
    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <h3>IDE</h3>
      <h6>Java based</h6>
      <img style="height: 350px;"src="img/arduino_ide.png" alt="">
    </div>
    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
      <h3>Toolchain</h3>
      <h6>AVR GCC</h6>
      <img src="img/avr_toolchain.png" alt="">
    </div>
  </div>
</section>
